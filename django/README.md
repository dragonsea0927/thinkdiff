# Table of Contents
1. [Django](#django-commands)
2. [Heroku](#heroku-commands)

## Django Commands

### New Directory
```
mkdir demo
cd demo
```

### VirtualEnv and PIP

```
pipenv install django
pipenv shell # activate virtual environment
```

### Project and App

```
django-admin startproject name_project .
python manage.py startapp app_name
```

### Database
```
python manage.py migrate # First Time
```

### Modification of Model ORM

```
python manage.py makemigrations app_name 
python manage.py migrate app_name 
```

### Super User Create for Admin

```
python manage.py createsuperuser
```

### Common Ref:
1. [Builtin Template](https://docs.djangoproject.com/en/2.0/ref/templates/builtins/#std:templatetag-block)

### Django Rest Framework
```
pipenv install djangorestframework
```

### Within Installed App Write

```
'rest_framework'
```

### In Pipenv Updating Python
```
pipenv install --python 3.7
```

## Heroku Commands

1. In a project, `git init`
2. Update `Pipfile.lock`
3. Create New `Procfile`
4. Install `gunicorn`
5. Update `settings.py`

### Add the following lines in Pipfile at the end:
```
# Pipfile
[requires]
python_version = "3.7"
```

> Run following commands to update Pipfile.lock. 
> Heroku will use it to generate a new environment on Heroku Server

```
pipenv lock
```

### Create a new file named `Procfile` in the directory:

```
touch Procfile
```

### Write the following line in `Procfile` to tells heroku to use gunicorn web server. Change `projname_project` to your `django project name`

```
web: gunicorn projname_project.wsgi --log-file -
```

### Install gunicorn locally
```
pipenv install gunicorn
```

### Now updates projectname_project/settings.py
> '*' represents all domain to be accepted 

```
ALLOWED_HOSTS = ['*']
```

### Update git status

```
git status
git add -A
git commit -m "Heroku Configuration files updated"
git push -u origin master [ To push updates in remote server ]
```

### Heroku Deployment:

> First signup in Heroku and remember login info: username and password

> Install Heroku command line interface
https://devcenter.heroku.com/articles/heroku-cli#download-and-install

### Run the following commands
```
heroku --version
heroku login
heroku create 'optional-name' # 'optional-name' must be unique
```

### Configure git locally to push on Heroku
```
heroku git:remote -a 'optional-name' 
# or the name generated by create command
```

### Disable Static File Collection
```
heroku config:set DISABLE_COLLECTSTATIC=1
```

> Django doesn't support serving static files in production. So we can use WhiteNoise for that. http://whitenoise.evans.io/en/stable/

```
pipenv install whitenoise
```

### Now update the projname_project/settings.py. Orders matters

```
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'whitenoise.runserver_nostatic', # new!
    'django.contrib.staticfiles',
    'app',
]


MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware', # new!
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
```

At the end add the following lines:

```
STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles') # new!
STATIC_URL = '/static/'
STATICFILES_DIRS = [os.path.join(BASE_DIR, 'static')]
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage' # new!
```

### Run collectstatic command
```
$ python3 manage.py collectstatic
```

### Update and Commit Changes in Git before pushing
```
git status
git add -A
git commit -m "Heroku Configuration files updated"
git push -u origin master [ To push updates in remote server ]
```

### Pushing to heroku and adding a web process to run

```
git push heroku master
heroku ps:scale web=1
```

URL of the app should be shown in command line output
